<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Endogenous Selection Models – EC910</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">EC910</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lecture-handouts" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Lecture Handouts</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lecture-handouts">    
        <li>
    <a class="dropdown-item" href="./handout-1.html">
 <span class="dropdown-text">Handout 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./handout-2.html">
 <span class="dropdown-text">Handout 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./handout-3.html">
 <span class="dropdown-text">Handout 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./handout-4.html">
 <span class="dropdown-text">Handout 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./handout-5.html">
 <span class="dropdown-text">Handout 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./handout-6.html">
 <span class="dropdown-text">Handout 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./handout-7.html">
 <span class="dropdown-text">Handout 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./handout-8.html">
 <span class="dropdown-text">Handout 8</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-problem-sets" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Problem Sets</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-problem-sets">    
        <li>
    <a class="dropdown-item" href="./problem-sets/ps-1/problem-set-1.html">
 <span class="dropdown-text">Problem Set 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./problem-sets/ps-1/problem-set-1-solutions.html">
 <span class="dropdown-text">Problem Set 1 (Solutions)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./problem-set-2.html">
 <span class="dropdown-text">Problem Set 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./problem-set-2-solutions.html">
 <span class="dropdown-text">Problem Set 2 (Solutions)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./problem-set-3.html">
 <span class="dropdown-text">Problem Set 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./problem-set-3-solutions.html">
 <span class="dropdown-text">Problem Set 3 (Solutions)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./problem-set-4.html">
 <span class="dropdown-text">Problem Set 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./problem-set-4-solutions.html">
 <span class="dropdown-text">Problem Set 4 (Solutions)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./problem-set-5.html">
 <span class="dropdown-text">Problem Set 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./problem-set-5-solutions.html">
 <span class="dropdown-text">Problem Set 5 (Solutions)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./problem-set-6.html">
 <span class="dropdown-text">Problem Set 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./problem-set-6-solutions.html">
 <span class="dropdown-text">Problem Set 6 (Solutions)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-additional-material" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Additional Material</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-additional-material">    
        <li>
    <a class="dropdown-item" href="./material-cef.html">
 <span class="dropdown-text">Conditional Expectation Function</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./material-interpretation.html">
 <span class="dropdown-text">Interpreting Linear Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./material-dummy.html">
 <span class="dropdown-text">Dummy Variables</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./material-linearalgebra.html">
 <span class="dropdown-text">Linear Algebra</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./material-inference.html">
 <span class="dropdown-text">Statistical Inference</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-revision" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Revision</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-revision">    
        <li>
    <a class="dropdown-item" href="./revision.html">
 <span class="dropdown-text">Revision</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">1</span> Overview</a></li>
  <li><a href="#censored-truncated-distributions" id="toc-censored-truncated-distributions" class="nav-link" data-scroll-target="#censored-truncated-distributions"><span class="header-section-number">2</span> Censored &amp; Truncated Distributions</a>
  <ul class="collapse">
  <li><a href="#censored-data" id="toc-censored-data" class="nav-link" data-scroll-target="#censored-data"><span class="header-section-number">2.1</span> Censored data</a></li>
  <li><a href="#truncated-data" id="toc-truncated-data" class="nav-link" data-scroll-target="#truncated-data"><span class="header-section-number">2.2</span> Truncated data</a></li>
  <li><a href="#truncated-normal-distribution" id="toc-truncated-normal-distribution" class="nav-link" data-scroll-target="#truncated-normal-distribution"><span class="header-section-number">2.3</span> Truncated normal distribution</a></li>
  <li><a href="#conditional-normal-distribution" id="toc-conditional-normal-distribution" class="nav-link" data-scroll-target="#conditional-normal-distribution"><span class="header-section-number">2.4</span> Conditional normal distribution</a></li>
  <li><a href="#inverse-mills-ratio" id="toc-inverse-mills-ratio" class="nav-link" data-scroll-target="#inverse-mills-ratio"><span class="header-section-number">2.5</span> Inverse Mills Ratio</a></li>
  </ul></li>
  <li><a href="#models" id="toc-models" class="nav-link" data-scroll-target="#models"><span class="header-section-number">3</span> Models</a>
  <ul class="collapse">
  <li><a href="#tobit-model" id="toc-tobit-model" class="nav-link" data-scroll-target="#tobit-model"><span class="header-section-number">3.1</span> Tobit model</a></li>
  <li><a href="#non-stochastic-threshold-model" id="toc-non-stochastic-threshold-model" class="nav-link" data-scroll-target="#non-stochastic-threshold-model"><span class="header-section-number">3.2</span> Non-stochastic threshold model</a></li>
  <li><a href="#stochastic-threshold-model" id="toc-stochastic-threshold-model" class="nav-link" data-scroll-target="#stochastic-threshold-model"><span class="header-section-number">3.3</span> Stochastic threshold model</a></li>
  <li><a href="#endogenous-switching-model" id="toc-endogenous-switching-model" class="nav-link" data-scroll-target="#endogenous-switching-model"><span class="header-section-number">3.4</span> Endogenous Switching Model</a></li>
  </ul></li>
  <li><a href="#estimation" id="toc-estimation" class="nav-link" data-scroll-target="#estimation"><span class="header-section-number">4</span> Estimation</a>
  <ul class="collapse">
  <li><a href="#tobit-model-1" id="toc-tobit-model-1" class="nav-link" data-scroll-target="#tobit-model-1"><span class="header-section-number">4.1</span> Tobit model</a></li>
  <li><a href="#threshold-model" id="toc-threshold-model" class="nav-link" data-scroll-target="#threshold-model"><span class="header-section-number">4.2</span> Threshold model</a></li>
  <li><a href="#observational-equivalence" id="toc-observational-equivalence" class="nav-link" data-scroll-target="#observational-equivalence"><span class="header-section-number">4.3</span> Observational equivalence</a></li>
  </ul></li>
  <li><a href="#interpretation" id="toc-interpretation" class="nav-link" data-scroll-target="#interpretation"><span class="header-section-number">5</span> Interpretation</a>
  <ul class="collapse">
  <li><a href="#tobit-model-2" id="toc-tobit-model-2" class="nav-link" data-scroll-target="#tobit-model-2"><span class="header-section-number">5.1</span> Tobit model</a></li>
  <li><a href="#threshold-model-1" id="toc-threshold-model-1" class="nav-link" data-scroll-target="#threshold-model-1"><span class="header-section-number">5.2</span> Threshold model</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">6</span> References</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="handout-7.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Endogenous Selection Models</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(latex2exp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="overview" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="overview"><span class="header-section-number">1</span> Overview</h2>
<p>In this handout we will review models that allow us to relax two important assumptions</p>
<ol type="1">
<li><p>random sampling in the cross-section dimension;</p></li>
<li><p>and unrestricted values of the dependent variable.</p></li>
</ol>
<p>In doing so, we will discuss two types of distributions:</p>
<ol type="1">
<li><p>truncated distribution</p></li>
<li><p>censored distribution</p></li>
</ol>
<p>Further reading can be found in:</p>
<ul>
<li>Chapter 16 of <span class="citation" data-cites="cameron2005">Cameron and Trivedi (<a href="#ref-cameron2005" role="doc-biblioref">2005</a>)</span></li>
<li>Section 7.4-7.6 of <span class="citation" data-cites="verbeek2017">Verbeek (<a href="#ref-verbeek2017" role="doc-biblioref">2017</a>)</span></li>
<li>Heckman, J.J. (1979) Sample selction bias as a specification error, Econometrica</li>
</ul>
</section>
<section id="censored-truncated-distributions" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="censored-truncated-distributions"><span class="header-section-number">2</span> Censored &amp; Truncated Distributions</h2>
<section id="censored-data" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="censored-data"><span class="header-section-number">2.1</span> Censored data</h3>
<p>In the case of censored data, there is <em>some</em> loss of information for the dependent variable but the explanatory variables are still observed. A common-case of censored data is top-coded income data in surveys; i.e.&nbsp;“Income great than $100,000”.</p>
<p>In the extreme, you can think of a discrete-choice binary data as censored, since we don’t observe the latent variable.</p>
<p>The following is an example of a left-censored distribution. For individuals with values of the outcome <span class="math inline">\(Y&lt;c\)</span>, we only observe the threshold <span class="math inline">\(c\)</span>. The distribution is given by,</p>
<p><span class="math display">\[
f(y) = \begin{cases} 0 \qquad \text{for} \quad y &lt;c \\
F^*(c)  \qquad \text{for} \quad y=c \\
f^*(y) \qquad \text{for} \quad y&gt;c
\end{cases}
\]</span></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Threshold</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the censored normal density function: x &gt; c</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span>c, <span class="at">to=</span><span class="dv">5</span>, <span class="at">by =</span> <span class="fl">0.05</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>cens_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span>x1, <span class="at">pdf =</span> <span class="fu">dnorm</span>(x1,<span class="at">sd=</span>sd))</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the uncensored normal density function</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="sc">-</span><span class="dv">5</span>, <span class="at">to=</span><span class="dv">5</span>, <span class="at">by =</span> <span class="fl">0.05</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>dens_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span>x2, <span class="at">pdf =</span> <span class="fu">dnorm</span>(x2,<span class="at">sd=</span>sd))</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate data for shading the area under the curve for x&lt;=c</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>x3 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, c, <span class="at">by =</span> <span class="fl">0.05</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>shade_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span>x3 ,<span class="at">ymin =</span> <span class="dv">0</span>,<span class="at">ymax =</span> <span class="fu">dnorm</span>(x3,<span class="at">sd=</span>sd))</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> cens_data, <span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>pdf), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> shade_data, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>ymin), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> c, <span class="at">y =</span> <span class="dv">0</span>), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> c, <span class="at">y =</span> <span class="fu">dnorm</span>(c,<span class="at">sd=</span>sd)), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">2</span>,<span class="at">shape=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> c, <span class="at">y =</span> <span class="fu">pnorm</span>(c,<span class="at">sd=</span>sd)), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dens_data, <span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>pdf), <span class="at">color =</span> <span class="st">"skyblue"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> shade_data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">ymin =</span> ymin, <span class="at">ymax =</span> ymax), <span class="at">fill =</span> <span class="st">"skyblue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">TeX</span>(<span class="st">"Censored distribution"</span>),</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Density"</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(c),            </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"c"</span>)  </span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> c<span class="sc">*</span><span class="dv">3</span>, <span class="at">y =</span> <span class="fl">0.1</span>, <span class="at">label =</span> <span class="st">"Censored region"</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="handout-7_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="truncated-data" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="truncated-data"><span class="header-section-number">2.2</span> Truncated data</h3>
<p>In truncated samples, both the dependent and explanatory variables are missing for some observations where he outcome value is one side of a threshold. For example, you might only observe the test score (and characteristics) of students who passed the test.</p>
<p>Another famous example is the labour market: we only observe the wages of those who are employed. Consider a consider where workers are observed working when they receive a wage offer that is as least as good as their reservation wage. According to such a model, those who are not employed must have received wage offers less than their reservation wage. It suggests, that the distribution of accepted wage offers will be truncated.</p>
<p>The following, is an example of a distribution that is left-truncated. We only observe values of <span class="math inline">\(Y\)</span> for <span class="math inline">\(Y\geq c\)</span>. The density of a left-truncated random variable is,</p>
<p><span class="math display">\[
f(y) = f^*(y|y&gt;c) = \frac{f^*(y)}{1-F^*(c)}  
\]</span> where <span class="math inline">\(1-F^*(c) = Pr(y|y&gt;c)\)</span>. In this way, truncation reduces the range of values the outcome variable can take. In this case, the mean of the truncated variable is greater than the unconditional mean.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Threshold</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the truncated normal density function: x &gt; c</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span>c, <span class="at">to=</span><span class="dv">5</span>, <span class="at">by =</span> <span class="fl">0.05</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>trun_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span>x1, <span class="at">pdf =</span> <span class="fu">dnorm</span>(x1,<span class="at">sd=</span>sd)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">pnorm</span>(c,<span class="at">sd=</span>sd)))</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the untruncated normal density function</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="sc">-</span><span class="dv">5</span>, <span class="at">to=</span><span class="dv">5</span>, <span class="at">by =</span> <span class="fl">0.05</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>dens_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span>x2, <span class="at">pdf =</span> <span class="fu">dnorm</span>(x2,<span class="at">sd=</span>sd))</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate data for shading the area under the curve for x&lt;=c</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>x3 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, c, <span class="at">by =</span> <span class="fl">0.05</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>shade_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span>x3 ,<span class="at">ymin =</span> <span class="dv">0</span>,<span class="at">ymax =</span> <span class="fu">dnorm</span>(x3,<span class="at">sd=</span>sd))</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> trun_data, <span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>pdf), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> shade_data, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>ymin), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> c, <span class="at">y =</span> <span class="dv">0</span>), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> c, <span class="at">y =</span> <span class="fu">dnorm</span>(c,<span class="at">sd=</span>sd)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">pnorm</span>(c,<span class="at">sd=</span>sd))), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dens_data, <span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>pdf), <span class="at">color =</span> <span class="st">"pink"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> shade_data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">ymin =</span> ymin, <span class="at">ymax =</span> ymax), <span class="at">fill =</span> <span class="st">"pink"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">TeX</span>(<span class="st">"Truncated distribution"</span>),</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Density"</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(c),            </span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"c"</span>)  </span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> c<span class="sc">*</span><span class="dv">3</span>, <span class="at">y =</span> <span class="fl">0.1</span>, <span class="at">label =</span> <span class="st">"Truncated region"</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="handout-7_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="truncated-normal-distribution" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="truncated-normal-distribution"><span class="header-section-number">2.3</span> Truncated normal distribution</h3>
<p>Before we proceed, it is worth revising some useful traits of (joint) normal distributions.</p>
<p>We know that if <span class="math inline">\(X\sim N(\mu,\sigma^2)\)</span>, then <span class="math inline">\(Z = \frac{X-\mu}{\sigma}\sim N(0,1)\)</span> (standard normal distribution). Moreover, as discussed in Handout 6, the pdf and cdf of the standard normal distribution are given by,</p>
<p><span class="math display">\[
\phi(z) = \frac{1}{\sqrt{2\pi}}exp(-z^2/2)
\]</span> and the CDF by, <span class="math display">\[
\Phi(z) = \frac{1}{\sqrt{2\pi}}\int_{-\infty}^z exp(-u^2/2)du
\]</span></p>
<p>The pdf of the <span class="math inline">\(X\)</span> is given by,</p>
<p><span class="math display">\[
f_X(x) = \frac{1}{\sqrt{2\pi\sigma^2}}exp\bigg(-\frac{1}{2}\bigg(\frac{x-\mu}{\sigma}\bigg)^2\bigg) = \frac{1}{\sigma}\phi(z)
\]</span> and the cdf by, <span class="math display">\[
F_X(x) = \Phi(z) \qquad \text{where}\quad z = \frac{x-\mu}{\sigma}
\]</span> We can evaluate the truncated mean of <span class="math inline">\(Z\sim N(0,1)\)</span>. First from the left:</p>
<p><span class="math display">\[
\begin{aligned}
E[Z|Z&gt;c] =&amp; \int_{c}^{+\infty}z\frac{\phi(z)}{1-\Phi(c)}dz \\
=&amp; \frac{1}{1-\Phi(c)}\int_{c}^{+\infty}z\phi(z)dz \\
=&amp; \frac{1}{1-\Phi(c)}\int_{c}^{+\infty}-\phi'(z)dz \\
=&amp; \frac{\phi(c)}{1-\Phi(c)}
\end{aligned}
\]</span> Next from the left: <span class="math display">\[
\begin{aligned}
E[Z|Z&lt;c] =&amp; \int_{-\infty}^{c}z\frac{\phi(z)}{\Phi(c)}dz \\
=&amp; \frac{1}{\Phi(c)}\int_{-\infty}^{c}z\phi(z)dz \\
=&amp; \frac{1}{\Phi(c)}\int_{-\infty}^{c}-\phi'(z)dz \\
=&amp; \frac{-\phi(c)}{\Phi(c)} \\
=&amp;-E[Z|Z&gt;-c]
\end{aligned}
\]</span> where the last line is given by the symmetry of the standard normal distribution: <span class="math inline">\(\phi(c)=\phi(-c)\)</span> and <span class="math inline">\(\Phi(c)=1-\Phi(-c)\)</span>. The function <span class="math inline">\(\frac{\phi(c)}{\Phi(c)} = E[Z|Z&gt;-c]\)</span> is referred to as the inverse mills ratio.</p>
</section>
<section id="conditional-normal-distribution" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="conditional-normal-distribution"><span class="header-section-number">2.4</span> Conditional normal distribution</h3>
<p>Let <span class="math inline">\(\begin{bmatrix}Y &amp; X\end{bmatrix}'\)</span> be joint normal:</p>
<p><span class="math display">\[
\begin{bmatrix}Y \\ X\end{bmatrix}\sim N\bigg(\begin{bmatrix}\mu_X \\ \mu_Y\end{bmatrix},\begin{bmatrix}\sigma^2_{Y} &amp; \sigma_{YX} \\ \sigma_{XY} &amp; \sigma^2_{X}\end{bmatrix}\bigg)
\]</span> where <span class="math inline">\(\sigma_{YX}=\sigma_{XY}\)</span>. Then,</p>
<p><span class="math display">\[
Y|X\sim N\bigg(\mu_Y + \frac{\sigma_{YX}}{\sigma_X^2}(X-\mu_X),\sigma^2_{Y}-\sigma_{YX}^2/\sigma^2_{X}\bigg)
\]</span> Note, the conditional mean of <span class="math inline">\(E[Y|X]=\mu_Y + \frac{\sigma_{YX}}{\sigma_X^2}(X-\mu_X)\)</span> is a linear function of X.</p>
</section>
<section id="inverse-mills-ratio" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="inverse-mills-ratio"><span class="header-section-number">2.5</span> Inverse Mills Ratio</h3>
<p>Using the above result characteristic, we can show that if <span class="math inline">\(\begin{bmatrix}\varepsilon_i &amp; \upsilon_i\end{bmatrix}'\)</span> are jointly normal, <strong>with mean zero</strong>, then</p>
<p><span class="math display">\[
\begin{aligned}
E[\varepsilon_i|\upsilon_i&gt;-c] =&amp; E\big[E[\varepsilon_i|\upsilon_i,\upsilon_i&gt;-c]\big|\upsilon_i&gt;-c\big] \\
=&amp; E\bigg[\frac{\sigma_{\varepsilon\upsilon}}{\sigma_\upsilon^2}\upsilon_i\bigg|\upsilon_i&gt;-c\bigg] \\
=&amp;\frac{\sigma_{\varepsilon\upsilon}}{\sigma_\upsilon^2}E[\upsilon_i|\upsilon_i&gt;-c] \\
=&amp;\frac{\sigma_{\varepsilon\upsilon}}{\sigma_\upsilon^2}\sigma_\upsilon E\bigg[\frac{\upsilon_i}{\sigma_\upsilon}\bigg|\frac{\upsilon_i}{\sigma_\upsilon}&gt;-\frac{c}{\sigma_\upsilon}\bigg] \\
=&amp;\frac{\sigma_{\varepsilon\upsilon}}{\sigma_\upsilon}\frac{\phi(c/\sigma_\upsilon)}{\Phi(c/\sigma_\upsilon)} \\
=&amp; \frac{\sigma_{\varepsilon\upsilon}}{\sigma_\upsilon}\lambda(c')
\end{aligned}
\]</span> where <span class="math inline">\(c' = c/\sigma_\upsilon\)</span>. In models where <span class="math inline">\(\upsilon_i\)</span> is the error from the selection equation, <span class="math inline">\(\sigma_\upsilon\)</span> is not identified and must be normalized to 1. Thus, <span class="math inline">\(c' = c\)</span>.</p>
</section>
</section>
<section id="models" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="models"><span class="header-section-number">3</span> Models</h2>
<p>In this section we will review a series of models that build on the latent variable model in Handout 6.</p>
<p><span class="math display">\[
Y_i^* = X_i'\beta + \varepsilon_i
\]</span> We want to learn about <span class="math inline">\(\beta\)</span>, but <span class="math inline">\(Y^*_i\)</span> is only partially observed due to some selection process. We will first review the Tobit model, where the outcome is censored. For example, top-coded earnings data. Next, we will look at selection/threshold models, where the outcome is observed based on a selection decision. For example, non-response in a survey. Finally, will look at endogenous switching models, where you observe the outcome under different potential states, and a selection decision determines the state of observation. For example, wages earned in different sectors of the economy.</p>
<p>In all cases, the regressors (covariates) will be observed regardless of selection. This is important as we would otherwise not be able to identify the selection decision. Thus, we will not be able to evaluate truncated samples, where covariates are not observed when the outcome is not observed. For example, data on political donations.</p>
<section id="tobit-model" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="tobit-model"><span class="header-section-number">3.1</span> Tobit model</h3>
<p>In a Tobit model, the outcome is censored. You observe <span class="math inline">\(Y_i^*\)</span> only above (or below) a given threshold <span class="math inline">\(c\)</span>, otherwise you observe the threshold value. However, you do observe the regressors (covariates) for all observations (regardless of censoring).</p>
<p><span class="math display">\[
Y_i = \begin{cases}Y_i^* \qquad \text{if} \quad D_i=1 \\
c \qquad \text{if} \quad D_i=0 \end{cases}
\]</span> where,</p>
<p><span class="math display">\[
D_i = \begin{cases}1 \qquad \text{if} \quad Y^*&gt;c \\
0 \qquad \text{if} \quad Y^*\leq c \end{cases}
\]</span> Given the latent variable model, you observe, <span class="math display">\[
Y_i = \begin{cases}X_i'\beta + \varepsilon_i \qquad \text{if} \quad X_i'\beta + \varepsilon_i&gt;c \\
c \qquad \text{if} \quad X_i'\beta + \varepsilon_i\leq c \end{cases}
\]</span> This is an example of left-censoring, but we could equally allow for right-censoring or both left- and right-censoring.</p>
<p>The conditional mean of the observed outcome (above the threshold) is given by:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;E[Y_{i}|D_i=1,X_i] \\
=&amp; E[Y_{i}^*|Y_i^*&gt;c,X_i] \\
=&amp;X_i'\beta + E[\varepsilon_{i}|\varepsilon_i&gt;c-X_i'\beta,X_i]
\end{aligned}
\]</span> A defining feature of the Tobit model is that observation, or selection, depends on the (latent) outcome <span class="math inline">\(Y^*\)</span> alone. The following two selection models introduce a separate latent variable that determines selection.</p>
</section>
<section id="non-stochastic-threshold-model" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="non-stochastic-threshold-model"><span class="header-section-number">3.2</span> Non-stochastic threshold model</h3>
<p>The outcome <span class="math inline">\(Y^*\)</span> is missing for some units, as in the case of truncated data. However, we do do observe the vector of characteristics <span class="math inline">\(X_i\)</span> and <span class="math inline">\(Z_i\)</span> (which may overlap) for all units. This is referred to as a <strong>selected sample</strong>. Note, some texts refer to the threshold model as the Heckman selection model, or Heckit for short.</p>
<p>Let <span class="math inline">\(D^*_i\)</span> be a second <em>continuous</em> latent outcome, that determines observation/selection,</p>
<p><span class="math display">\[
D_i^* = Z_i'\gamma + \upsilon_i
\]</span> As in a binary choice model (see Handout 6), the observable dummy-variable, <span class="math inline">\(D_i\)</span>, which denotes selection into the observed sample, can be defined as,</p>
<p><span class="math display">\[
D_i = \begin{cases}1 \qquad \text{if} \quad D_i^*&gt;0 \\
0 \qquad \text{otherwise}\end{cases}
\]</span> For example, <span class="math inline">\(D_i\)</span> may identify employment in a wage model where you only observe wages of employed individuals.</p>
<p>The observed outcome <span class="math inline">\(Y_i\)</span> is then,</p>
<p><span class="math display">\[
Y_i = \begin{cases}Y_i^* \qquad \text{if} \quad D_i=1 \\
\text{missing} \qquad \text{otherwise} \end{cases}
\]</span> Given the latent variable models for <span class="math inline">\(Y_i^*\)</span> and <span class="math inline">\(D_i^*\)</span>, this can be written as,</p>
<p><span class="math display">\[
Y_i = \begin{cases}X_i'\beta + \varepsilon_i \qquad \text{if} \quad Z_i'\gamma +\upsilon_i&gt;0 \\
\text{missing} \qquad \text{otherwise} \end{cases}
\]</span></p>
<p>The model has two error terms which means that we need to make an assumption about their <strong>joint</strong> distribution. If the two errors are independent, then we can ignore the missing observations; i.e., there is no selection bias.</p>
<p>Consider the conditional mean of the (observed) outcome:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;E[Y_i|D_i=1,X_i] \\
=&amp; E[Y_i^*|D_i=1,X_i] \\
=&amp;X_i'\beta + E[\varepsilon_i|D_i^*&gt;0,X_i] \\
=&amp;X_i'\beta + E[\varepsilon_i|\upsilon_i&gt;-Z_i'\gamma,X_i] \\
\end{aligned}
\]</span></p>
<p>In general, <span class="math inline">\(E[\varepsilon_i|\upsilon_i&gt;-Z_i'\gamma,X_i]\neq 0\)</span>. This means that the OLS estimator of,</p>
<p><span class="math display">\[
Y_i = X_i'\beta + \varepsilon_i \qquad \text{for}\quad i:D_i = 1
\]</span></p>
<p>is biased. However, if we know the (conditional) joint distribution of <span class="math inline">\(\begin{bmatrix}\varepsilon_i &amp; \upsilon_i\end{bmatrix}'\)</span> then we may be able to compute this bias and explicitly correct for it in the model. We will shortly see that the assumption of joint normality provides a relatively simple solution to the problem.</p>
</section>
<section id="stochastic-threshold-model" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="stochastic-threshold-model"><span class="header-section-number">3.3</span> Stochastic threshold model</h3>
<p>In the above model, selection (into observation of <span class="math inline">\(Y_i\)</span>) was determined by a separate latent variable to the main outcome. As a result, the correlation between <span class="math inline">\(Y_i^*\)</span> and <span class="math inline">\(D_i\)</span> (or <span class="math inline">\(D_i^*\)</span>) depended on the unobserved joint error-term distribution. In a stochastic threshold model, the selection depends directly on <span class="math inline">\(Y_i^*\)</span>. <span class="math display">\[
Y_i = \begin{cases}Y_i^* \qquad \text{if} \quad Y_i^*&gt;S_i^* \\
\text{missing} \qquad \text{otherwise} \end{cases}
\]</span> where, <span class="math display">\[
S_i^* = W_i'\eta + \nu_i
\]</span> Thus, the indicator of observation is given by, <span class="math display">\[
D_i = \begin{cases}1 \qquad \text{if} \quad Y_i^*&gt;S_i^* \\
0 \qquad \text{otherwise}\end{cases}
\]</span> Selection depends on the realization of <span class="math inline">\(\varepsilon_i\)</span> and not just on <span class="math inline">\(Cov(\varepsilon_i,\upsilon_i)\)</span> (where <span class="math inline">\(\upsilon_i\)</span> is the error term from the selection equation in the non-stochastic model).</p>
<p>The observed <span class="math inline">\(Y_i\)</span> is given by, <span class="math display">\[
Y_i = \begin{cases}X_i'\beta + \varepsilon_i \qquad \text{if} \quad X_i'\beta + \varepsilon_i\geq W_i'\eta + \nu_i \\
\text{missing} \qquad \text{otherwise} \end{cases}
\]</span> As before, consider the conditional mean of the observed outcome: <span class="math display">\[
\begin{aligned}
&amp;E[Y_i|D_i=1,X_i] \\
=&amp; E[Y_i^*|D_i=1,X_i] \\
=&amp;X_i'\beta + E[\varepsilon_i|D_i^*&gt;0,X_i] \\
=&amp;X_i'\beta + E[\varepsilon_i|(Y_i^*-S_i^*)&gt;0,X_i] \\
=&amp;X_i'\beta + E[\varepsilon_i|\upsilon_i&gt;-Z_i'\gamma,X_i]
\end{aligned}
\]</span> where, <span class="math display">\[
\upsilon_i = \varepsilon_i-\nu_i \qquad \text{and}\qquad Z_i'\gamma = X_i'\beta - W_i'\eta
\]</span> This result shows that the two models - non-stochastic and stochastic threshold models - are equivalent. This equivalence will have implications for the interpretation of the parameters.</p>
<p>Consider, in the non-stochastic model, we have to consider <span class="math inline">\(Cov(\varepsilon_i,\upsilon_i)\)</span>. In the stochastic model, this is, <span class="math display">\[
Cov(\varepsilon_i,\upsilon_i) = Cov(\varepsilon_i,\varepsilon_i-\nu_i) = Var(\varepsilon_i)-Cov(\varepsilon_i,\nu_i)
\]</span> If the <span class="math inline">\(Cov(\varepsilon_i,\nu_i)=0\)</span> (i.e., no selection in the stochastic model), then <span class="math inline">\(Cov(\varepsilon_i,\upsilon_i)&gt;0\)</span>.</p>
<p>The equivalence of these models also implies that <span class="math inline">\(Z_i\)</span> must contain all variables in either <span class="math inline">\(X_i\)</span> or <span class="math inline">\(W_i\)</span>. However, some variables in <span class="math inline">\(W_i\)</span> need not appear in <span class="math inline">\(X_i\)</span>. There may be some variables in the selection equation that do not appear in the main equation. These are referred to as excluded variables.</p>
<p>In both threshold models, selection is determined by both observables (<span class="math inline">\(W_i\)</span>) and unobservables (<span class="math inline">\(\upsilon_i\)</span>). Other methods, like propensity score matching assume that selection is determined by observables alone. Instrumental variable approaches allow for selection on both, but do require an excluded instrument.</p>
</section>
<section id="endogenous-switching-model" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="endogenous-switching-model"><span class="header-section-number">3.4</span> Endogenous Switching Model</h3>
<p>Consider a model where there are two latent outcomes <span class="math inline">\(\{Y_{1i}^*,Y_{2i}^*\}\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
Y_{1i}^* =&amp; X_i'\beta_1 + \varepsilon_{1i} \\
Y_{2i}^* =&amp; X_i'\beta_2 + \varepsilon_{2i}
\end{aligned}
\]</span></p>
<p>For example, these could be wage equations from two sectors. Observation within either state is then determined by another latent variable <span class="math inline">\(D_i^*\)</span>:</p>
<p><span class="math display">\[
Y_i = \begin{cases}Y_{1i}^* \qquad \text{if} \quad D_i^*&gt;0 \\
Y_{2i}^* \qquad \text{otherwise} \end{cases}
\]</span></p>
<p>where,</p>
<p><span class="math display">\[
D_i^* = Z_i\gamma + \theta (Y_{1i}^*-Y_{2i}^*) + \zeta_i
\]</span> You could extent this to more than 2 states; but that makes modelling selection a little more complex. In this simple set-up, the observed outcome is given by, <span class="math display">\[
Y_i = \begin{cases}X_i'\beta_1 + \varepsilon_{1i} \qquad \text{if} \quad Z_i\gamma + \theta (Y_{1i}^*-Y_{2i}^*) + \zeta_i&gt;0 \\
X_i'\beta_2 + \varepsilon_{2i} \qquad \text{otherwise} \end{cases}
\]</span></p>
<p>An important limitation within this model is the absence of any state-specific covariates in either the <span class="math inline">\(\{Y_{1i}^*,Y_{2i}^*\}\)</span> latent models or <span class="math inline">\(D_i^*\)</span> selection model. Selection can only depend on the difference in the latent outcomes.</p>
<p>For each individual, we only observe one of the outcomes, which is to say there is a “missing counterfactual”. This is a similar structure then to the potential outcomes framework discussed in Handout 8. Although, with important differences. Here, each covariate has a state-specific vector <span class="math inline">\(\beta_m\)</span>.</p>
<p>The conditional mean of the observed outcome in each state is given by:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;E[Y_{1i}|D_i=1,X_i] \\
=&amp; E[Y_{1i}^*|D_i=1,X_i] \\
=&amp;X_i'\beta_1 + E[\varepsilon_{1i}|D_i^*&gt;0,X_i] \\
=&amp;X_i'\beta_1 + E[\varepsilon_{1i}|\zeta_i&gt;-Z_i'\gamma-\theta (Y_{1i}^*-Y_{2i}^*),X_i]
\end{aligned}
\]</span> for state 1, and for state 2: <span class="math display">\[
\begin{aligned}
&amp;E[Y_{2i}|D_i=0,X_i] \\
=&amp; E[Y_{2i}^*|D_i=0,X_i] \\
=&amp;X_i'\beta_2 + E[\varepsilon_{2i}|D_i^*\leq0,X_i] \\
=&amp;X_i'\beta_2 + E[\varepsilon_{2i}|\zeta_i\leq -Z_i'\gamma-\theta (Y_{1i}^*-Y_{2i}^*),X_i]
\end{aligned}
\]</span></p>
</section>
</section>
<section id="estimation" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="estimation"><span class="header-section-number">4</span> Estimation</h2>
<p>The goal is to estimate the <span class="math inline">\(\beta\)</span> parameters from the latent model under various observation mechanisms.</p>
<p><span class="math display">\[
Y_i^* = X_i^*\beta + \varepsilon_i
\]</span></p>
<p>However, we can only ever use the observed outcome <span class="math inline">\(Y_i\)</span> and <span class="math inline">\(D_i\)</span> (indicator of selection/observation).</p>
<section id="tobit-model-1" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="tobit-model-1"><span class="header-section-number">4.1</span> Tobit model</h3>
<p>Recall, the conditional mean of the observed (non-censored) outcome variable. Applying the definition of the IMR, we have,</p>
<p><span class="math display">\[
\begin{aligned}
E[Y_{i}|Y_i^*&gt;c,X_i] =&amp;X_i'\beta + E[\varepsilon_{i}|\varepsilon_i&gt;c-X_i'\beta,X_i] \\
=&amp;X_i'\beta + \sigma_\varepsilon E\bigg[\frac{\varepsilon_i}{\sigma_\varepsilon}\bigg|\frac{\varepsilon_i}{\sigma_\varepsilon}&gt;\frac{c-X_i'\beta}{\sigma_\varepsilon},X_i\bigg] \\
=&amp;X_i'\beta + \sigma_\varepsilon \lambda\bigg(\frac{X_i'\beta-c}{\sigma_\varepsilon}\bigg)
\end{aligned}
\]</span> This equation can be estimated by OLS using a two-step estimator (see of Heckman correction below). However, the more efficient estimator is Maximum Likelihood. The joint likelihood is given by,</p>
<p><span class="math display">\[
\begin{aligned}
L_n(\theta) =&amp;\prod_{i:D_i=1}f^*(Y_i|X_i;\theta)\prod_{i:D_i=0}F^*(c_i|X_i;\theta) \\
  =&amp;\prod_{i=1}^n\bigg(\frac{1}{\sigma_\varepsilon}\phi\bigg(\frac{Y_i-X_i'\beta}{\sigma_\varepsilon}\bigg)\bigg)^{D_i}\Phi\bigg(\frac{c-X_i'\beta}{\sigma_\varepsilon}\bigg)^{1-D_i}
  \end{aligned}
\]</span> where <span class="math inline">\(\theta = [\beta,\sigma_\varepsilon]\)</span> and <span class="math inline">\(F^*(c_i|X_i;\theta) = Pr(Y_i\leq c|X_i)\)</span>.</p>
<p>Notice, the first part of the likelihood function looks like the likelihood of the CLRM (from Handout 3) while the second part is similar to a probit model likelihood function for <span class="math inline">\(D_i=0\)</span> (from Handout 6). One issue with the likelihood function is that it is not globally concave (see Tobit II model).</p>
</section>
<section id="threshold-model" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="threshold-model"><span class="header-section-number">4.2</span> Threshold model</h3>
<p>Heckman (1979) put forward a novel solution for the estimation of sample selection models. The approach adds a generated-regressor to the (linear) estimating equation that corrects for the endogenous selection. <em>Conditional on observation</em>, the error term in the <em>observed</em> model will not be mean zero. The approach is called a <strong>control function</strong> approach and means that the bias corrected model can be estimated using OLS and not ML (which was computationally demanding at the time).</p>
<p>Recall from the endogenous selection models (stochastic or non-stochatic), that the conditional mean of the observed outcome was,</p>
<p><span class="math display">\[
E[Y_i|D_i=1,X_i] = X_i'\beta + E[\varepsilon_i|\upsilon_i&gt;-Z_i'\gamma,X_i]
\]</span> Suppose, <span class="math display">\[
\begin{bmatrix}\varepsilon_i \\ \upsilon_i\end{bmatrix}|X_i\sim N\bigg(\begin{bmatrix}0 \\ 0\end{bmatrix},\begin{bmatrix}\sigma^2_{\varepsilon} &amp; \sigma_{\varepsilon\upsilon} \\ \sigma_{\varepsilon\upsilon} &amp; 1\end{bmatrix}\bigg)
\]</span> We need to normalize the variance of <span class="math inline">\(\upsilon_i\)</span> as it is not identified. Recall, <span class="math inline">\(\upsilon_i\)</span> is associated with the discrete outcome <span class="math inline">\(D_i\)</span> that indicates observation. Just as in a probit model, the variance of the latent variable model error term is not identified.</p>
<p>Given, the joint normality assumption: <span class="math display">\[
E[Y_i|D_i=1,X_i] = X_i'\beta + \sigma_{\varepsilon\upsilon}\lambda(Z_i'\gamma)
\]</span></p>
<p>The <strong>Heckman two-step estimator</strong> estimates the adjusted model,</p>
<p><span class="math display">\[
Y_i = X_i'\beta + \sigma_{\varepsilon\upsilon}\hat{\lambda}_i + \varepsilon_i \qquad \text{for}\quad i:D_i = 1
\]</span> where,</p>
<ol type="1">
<li>Estimate a probit model of <span class="math inline">\(D_i\)</span>, using variables <span class="math inline">\(Z\)</span> (those variables in <span class="math inline">\(X_i\)</span> and <span class="math inline">\(W_i\)</span>) and construct the IMR:</li>
</ol>
<p><span class="math display">\[
\hat{\lambda}_i = \lambda(Z_i'\hat{\gamma}) = \frac{\phi(Z_i'\hat{\gamma})}{\Phi(Z_i'\hat{\gamma})}
\]</span></p>
<ol start="2" type="1">
<li>Estimate the linear model with the added IMR using the observed (selected) sample.</li>
</ol>
<p>Recall, if <span class="math inline">\(\sigma_{\varepsilon\upsilon}=0\)</span> <strong>in the non-stochastic model</strong>, selection into observation is unrelated to the latent outcome. Hence, <span class="math inline">\(H_0:\sigma_{\varepsilon\upsilon}=0\)</span> is a valid test for the selection, <em>provided the model is non-stochastic</em>.</p>
<p>Since the second step includes a generated-regressor, the default vairance estimator will be incorrect. This is standard problem with two-step estimators, like two-stage-least-squares for instrumental variables.</p>
<p>Identifcation relies on the non-linearity of the IMR. The IMR can be approximately linear for some values which means that the identification depends on there being a significant share of observations in the tail where the IMR is non-linear. In practice, many researchers will include squared terms of the IMR. Identification does NOT rely on an excluded variable: a variable in the selection equation that does not appear in the main equation. However, it will help to have an excluded variable.</p>
<p>Heckman’s control function approach removed the need to use a Maximum Likelihood. However, the ML estimator is more efficient. The joint likelihood is given by,</p>
<p><span class="math display">\[
\begin{aligned}
L_n(\theta) =&amp;\prod_{i:D_i=1}f^*(Y_i|D_i=1,Z_i;\theta)\cdot Pr(D_i=1|Z_i)\prod_{i:D_i=0}Pr(D_i=0|Z_i) \\
=&amp; \prod_{i:D_i=1} f^*(Y_i|Z_i;\theta)\cdot Pr(D_i=1|Y_i,Z_i)\prod_{i:D_i=0}Pr(D_i=0|Z_i)\\
=&amp;\prod_{i=1}^n\bigg[\frac{1}{\sigma_\varepsilon}\phi\bigg(\frac{Y_i-X_i'\beta}{\sigma_\varepsilon}\bigg)\cdot\Phi\bigg(\frac{Z_i'\gamma+\sigma_{\varepsilon\upsilon}\sigma_{\varepsilon}^{-2} (Y_i-X_i'\beta)}{\sqrt{1-\sigma_{\varepsilon\upsilon}^2\sigma_{\varepsilon}^{-2}}}\bigg)\bigg]^{D_i}(1-\Phi(Z_i'\gamma)\big)^{1-D_i}
\end{aligned}
\]</span> where <span class="math inline">\(\theta=[\beta,\gamma,\sigma_\varepsilon,\sigma_{\varepsilon\upsilon}]\)</span>. Line two follows from Bayes’ rule. The second term in the third row derives from:</p>
<p><span class="math display">\[
\begin{aligned}
Pr(D_i=1|Y_i,Z_i) =&amp; Pr(\upsilon_i&gt;-Z_i'\gamma|Y_i,Z_i) \\
=&amp; Pr(\sigma_{\varepsilon\upsilon}/\sigma_{\varepsilon}^2\varepsilon_i+ \zeta_i &gt;-Z_i'\gamma|Y_i,Z_i) \\
=&amp; Pr(\zeta_i &gt;-Z_i'\gamma-\sigma_{\varepsilon\upsilon}/\sigma_{\varepsilon}^2\varepsilon_i|Y_i,Z_i) \\
=&amp; \Phi\bigg(\frac{Z_i'\gamma+\sigma_{\varepsilon\upsilon}\sigma_{\varepsilon}^{-2} (Y_i-X_i'\beta)}{\sqrt{1-\sigma_{\varepsilon\upsilon}^2\sigma_{\varepsilon}^{-2}}}\bigg)
\end{aligned}
\]</span> This is because of the joint normality of the errors, which allows us to write,</p>
<p><span class="math display">\[
\upsilon_i = \sigma_{\varepsilon\upsilon}/\sigma_{\varepsilon}^2\varepsilon_i+ \zeta_i \qquad \text{where}\quad \zeta_i\sim N(0,1-\sigma^2_{\varepsilon\upsilon}/\sigma_{\varepsilon}^2)
\]</span> Conditional on <span class="math inline">\(Y_i^*\)</span>, <span class="math inline">\(\varepsilon_i\)</span> is not random, which is why is moved to the right-handside and is substituted with <span class="math inline">\(\varepsilon_i=Y_i-X_i'\beta\)</span>.</p>
<p>Notice, if <span class="math inline">\(\sigma_{\varepsilon\upsilon}=0\)</span>, then likelihood of selection and observing <span class="math inline">\(Y_i\)</span> are independent of one another.</p>
</section>
<section id="observational-equivalence" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="observational-equivalence"><span class="header-section-number">4.3</span> Observational equivalence</h3>
<p>In the non-stochastic threshold model, <span class="math inline">\(Cov(\varepsilon_i,\upsilon_i)=\sigma_{\varepsilon\upsilon}=0\)</span> implies there is not selection-bias in the main equation. However, in the stochastic model <span class="math inline">\(\sigma_{\varepsilon\upsilon}&gt;0\)</span> cannot be zero; since <span class="math inline">\(\upsilon_i = \varepsilon_i-\nu_i\)</span></p>
<p><span class="math display">\[
Cov(\varepsilon_i,\upsilon_i) = Cov(\varepsilon_i,\varepsilon_i-\nu_i) = Var(\varepsilon_i)-Cov(\varepsilon_i,\nu_i)
\]</span> In the stochastic model, <em>when</em> there is no selection if <span class="math inline">\(Cov(\varepsilon_i,\nu_i)=0\)</span>. However, this implies that <span class="math inline">\(\sigma_{\varepsilon\upsilon}=\sigma_\varepsilon\)</span>. As a result,</p>
<p><span class="math display">\[
E[Y_i|D_i=1,X_i] = X_i'\beta + \sigma_{\varepsilon\upsilon}\lambda(Z_i'\gamma) = X'\beta + \sigma_\varepsilon\lambda(X_i'\beta)
\]</span></p>
<p>The stochastic threshold model returns a Tobit model when there is no selection.</p>
<p>We have a puzzle! You cannot distinguish the stochastic and non-stochastic threshold models. The test for selection - <span class="math inline">\(H_0:\sigma_{\varepsilon\upsilon}=0\)</span> - using the coefficient on the IMR is only valid under the non-stochastic case, since <span class="math inline">\(\sigma_{\varepsilon\upsilon}&gt;0\)</span> in the stochastic case. This means that if the stochastic model is valid, there is no test for selection. And if there is no selection, in the stochastic model, the model is essentially a tobit model.</p>
<p>This puzzle suggests that all three models are empirically indistinguishable. You need to make an economic argument for why one model is valid.</p>
</section>
</section>
<section id="interpretation" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="interpretation"><span class="header-section-number">5</span> Interpretation</h2>
<p>In the above models, any regressor affects expected value of the observed outcome through two potential channels: (1) the direct effect; (2) the selection effect.</p>
<p>Consider, there is the effect of <span class="math inline">\(X_i\)</span> on the latent outcome:</p>
<p><span class="math display">\[
\frac{\partial E[Y_i^*|X_i]}{\partial X_i} = \beta
\]</span></p>
<p>Then, there is the effect of <span class="math inline">\(Z_i\)</span> (which includes <span class="math inline">\(X_i\)</span>, but also potential excluded variables) on selection (into observation):</p>
<p><span class="math display">\[
\frac{\partial Pr(D_i=1|Z_i)}{\partial Z_i}
\]</span></p>
<p>Then, there is the effect of <span class="math inline">\(X_i\)</span> conditional on selection (observation),</p>
<p><span class="math display">\[
\frac{\partial E[Y_i|X_i,D_i=1]}{\partial X_i}
\]</span> and the total effect of <span class="math inline">\(X_i\)</span> on the observed outcome:</p>
<p><span class="math display">\[
\frac{\partial E[Y_i|X_i]}{\partial X_i}
\]</span></p>
<section id="tobit-model-2" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="tobit-model-2"><span class="header-section-number">5.1</span> Tobit model</h3>
<p>We can use the Law of Iterated Expectations to expand the conditional mean of <span class="math inline">\(E[Y_i|X_i]\)</span>. Let where <span class="math inline">\(\omega_i= \frac{X_i'\beta-c}{\sigma_\varepsilon}\)</span>, then</p>
<p><span class="math display">\[
\begin{aligned}
E[Y_i|X_i] =&amp; E[Y_i|X_i,D_i=1]\cdot Pr(D_i=1|X_i)+E[Y_i|X_i,D_i=0]\cdot Pr(D_i=0|X_i) \\
=&amp;E[Y_i|X_i,D_i=1]\cdot Pr(D_i=1|X_i) + c\cdot Pr(D_i=0|X_i) \\
=&amp;\big[X_i'\beta + \sigma_\varepsilon \lambda(\omega_i)\big]\cdot \Phi(\omega_i)+c\cdot \big[1-\Phi(\omega_i)\big]
\end{aligned}
\]</span> Recall, in this case <span class="math inline">\(Pr(D_i=1|X_i)=Pr(Y_i^*&gt;c|X_i)\)</span>. Naturally, <span class="math inline">\(c=0\)</span> simplifies the expression.</p>
<p>The relevant marginal effects are:</p>
<ul>
<li><strong>conditional on observation/selection:</strong></li>
</ul>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial E[Y_i|D_i=1,X_i]}{\partial X_i} =&amp; \big[1 + \lambda'(\omega_i)\big]\beta \\
=&amp; \big[1 -\omega_i\cdot\lambda(\omega_i)-\lambda(\omega_i)^2\big]\beta
\end{aligned}
\]</span> You can verify this result using the definition of the IMR.</p>
<ul>
<li><strong>observation/selection:</strong></li>
</ul>
<p><span class="math display">\[
\frac{\partial Pr(Y_i=1|X_i)}{\partial X_i} = \phi(\omega_i)\beta/\sigma_\varepsilon
\]</span></p>
</section>
<section id="threshold-model-1" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="threshold-model-1"><span class="header-section-number">5.2</span> Threshold model</h3>
<p>Let us assume that all <span class="math inline">\(X_i\)</span> regressors are included in <span class="math inline">\(Z_i\)</span>, which we know should be the case given the observational equivalence of the stochastic and non-stochastic models. The above marginal effects for these selection models is given by,</p>
<ul>
<li><p><strong>conditional on selection:</strong> <span class="math display">\[
\begin{aligned}
\frac{\partial E[Y_i|D_i=1,Z_i]}{\partial X_i} =&amp; \beta + \sigma_{\varepsilon\upsilon}\lambda'(Z_i'\gamma)\tilde{\gamma} \\
=&amp;\beta -\sigma_{\varepsilon\upsilon}\big[Z_i'\gamma\cdot\lambda(Z_i'\gamma) + \lambda(Z_i'\gamma)^2\big]\tilde{\gamma}
\end{aligned}
\]</span> where <span class="math inline">\(\tilde{\gamma}\)</span> refers to the subset of <span class="math inline">\(\gamma\)</span>-vector corresponding to the <span class="math inline">\(X_i\)</span> regressors that appear in <span class="math inline">\(Z_i\)</span>. That is, it excludes the parameters on any excluded variables.</p></li>
<li><p><strong>selection:</strong></p></li>
</ul>
<p><span class="math display">\[
\frac{\partial Pr(D_i=1|Z_i)}{\partial Z_i} = \phi(Z_i'\gamma)\gamma
\]</span></p>
<p>Recall, in the threshold model the variance of the selection equation is not identified. Hence, the selection margin effect resembles that of a probit model. In the Tobit model, selection depends on the outcome itself and the variance can be identified from the part of the data where <span class="math inline">\(Y\)</span> is observed.</p>
</section>
</section>
<section id="references" class="level2" data-number="6">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">6 References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-cameron2005" class="csl-entry" role="listitem">
Cameron, A Colin, and Pravin K Trivedi. 2005. <em>Microeconometrics: Methods and Applications</em>. Cambridge university press.
</div>
<div id="ref-verbeek2017" class="csl-entry" role="listitem">
Verbeek, Marno. 2017. <em>A Guide to Modern Econometrics</em>. John Wiley &amp; Sons.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>